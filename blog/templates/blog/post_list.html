{% extends 'base.html' %}

{% block title %}Daftar Postingan{% endblock %}

{% block content %}
<h1>Daftar Postingan</h1>

<form method="GET" action="{% url 'blog:post_list' %}">
    <input type="text" name="q" placeholder="Cari postingan..." value="{{ query }}">
    
    <label>Kategori:
        <select name="category">
            <option value="">Semua Kategori</option>
            {% for category in categories %}
                <option value="{{ category.slug }}" {% if category.slug == request.GET.category %}selected{% endif %}>
                    {{ category.name }}
                </option>
            {% endfor %}
        </select>
    </label>

    <label>Tag:
        <select name="tag">
            <option value="">Semua Tag</option>
            {% for tag in tags %}
                <option value="{{ tag.slug }}" {% if tag.slug == request.GET.tag %}selected{% endif %}>
                    {{ tag.name }}
                </option>
            {% endfor %}
        </select>
    </label>

    <label>Penulis:
        <select name="author">
            <option value="">Semua Penulis</option>
            {% for author in authors %}
                <option value="{{ author.username }}" {% if author.username == request.GET.author %}selected{% endif %}>
                    {{ author.username }}
                </option>
            {% endfor %}
        </select>
    </label>

    <label>
        <input type="checkbox" name="sort" value="comments" {% if sort_by_comments %}checked{% endif %}>
        Urutkan Berdasarkan Jumlah Komentar
    </label>

    <button type="submit">Cari & Urutkan</button>
</form>

<ul>
    {% for post in page_obj %}
        <li>
            <a href="{{ post.get_absolute_url }}">{{ post.title }}</a>
            ({{ post.publish|date:"F d, Y" }})

            <p>Penulis: 
                <a href="{% url 'blog:post_list_by_author' post.author.username %}">{{ post.author.username }}</a>
            </p>

            <p>Kategori: 
                {% if post.category %}
                    <a href="{% url 'blog:post_list_by_category' post.category.slug %}">{{ post.category.name }}</a>
                {% else %}
                    Tidak ada
                {% endif %}
            </p>

            <p>Tags: 
                {% for tag in post.tags.all %}
                    <a href="{% url 'blog:post_list_by_tag' tag.slug %}">{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
                {% empty %}
                    Tidak ada tag.
                {% endfor %}
            </p>
        </li>
    {% empty %}
        <p>Tidak ada postingan yang ditemukan.</p>
    {% endfor %}
</ul>

<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">Awal</a>
            <a href="?page={{ page_obj.previous_page_number }}">Sebelumnya</a>
        {% endif %}

        <span>Halaman {{ page_obj.number }} dari {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">Berikutnya</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">Akhir</a>
        {% endif %}
    </span>
</div>
{% endblock %}
